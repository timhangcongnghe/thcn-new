jQuery(document).ready(function(o){function e(o,e){o=escape(o),e=escape(e);var t=document.location.search,a=o+"="+e,r=new RegExp("(&|\\?)"+o+"=[^&]*");return t=t.replace(r,"$1"+a),RegExp.$1||(t+=(t.length>0?"&":"?")+a),t}o(document).on("click",".product a.compare:not(.added)",function(e){e.preventDefault();var t=o(this),a={action:yith_thcncompare.actionadd,id:t.data("product_id"),context:"frontend"},r=o(".yith-thcncompare-widget ul.products-list");void 0!==o.fn.block&&(t.block({message:null,overlayCSS:{background:"#fff url("+yith_thcncompare.loader+") no-repeat center",backgroundSize:"16px 16px",opacity:.6}}),r.block({message:null,overlayCSS:{background:"#fff url("+yith_thcncompare.loader+") no-repeat center",backgroundSize:"16px 16px",opacity:.6}})),o.ajax({type:"post",url:yith_thcncompare.ajaxurl.toString().replace("%%endpoint%%",yith_thcncompare.actionadd),data:a,dataType:"json",success:function(e){void 0!==o.fn.block&&(t.unblock(),r.unblock()),t.addClass("added").attr("href",e.table_url).text(yith_thcncompare.added_label),r.html(e.widget_table),"yes"==yith_thcncompare.auto_open&&o("body").trigger("yith_thcncompare_open_popup",{response:e.table_url,button:t})}})}),o(document).on("click",".product a.compare.added",function(e){e.preventDefault();var t=this.href;void 0!==t&&o("body").trigger("yith_thcncompare_open_popup",{response:t,button:o(this)})}),o("body").on("yith_thcncompare_open_popup",function(e,t){var a=t.response;if(o(window).width()>=768)o.colorbox({href:a,iframe:!0,width:"90%",height:"90%",className:"yith_thcncompare_colorbox",close:yith_thcncompare.close_label,onClosed:function(){var e=o(".yith-thcncompare-widget ul.products-list"),t={action:yith_thcncompare.actionreload,context:"frontend"};void 0!==o.fn.block&&e.block({message:null,overlayCSS:{background:"#fff url("+yith_thcncompare.loader+") no-repeat center",backgroundSize:"16px 16px",opacity:.6}}),o.ajax({type:"post",url:yith_thcncompare.ajaxurl.toString().replace("%%endpoint%%",yith_thcncompare.actionreload),data:t,success:function(t){void 0!==o.fn.block&&e.unblock().html(t),e.html(t)}})}}),o(window).resize(function(){o.colorbox.resize({width:"90%",height:"90%"})});else{var r=a.split("?");if(r.length>=2){for(var c=encodeURIComponent("iframe")+"=",n=r[1].split(/[&;]/g),i=n.length;i-- >0;)-1!==n[i].lastIndexOf(c,0)&&n.splice(i,1);a=r[0]+"?"+n.join("&")}window.open(a,yith_thcncompare.table_title)}}),o(document).on("click",".remove a",function(e){e.preventDefault();var t=o(this),a={action:yith_thcncompare.actionremove,id:t.data("product_id"),context:"frontend"};o("td.product_"+a.id+", th.product_"+a.id),void 0!==o.fn.block&&t.block({message:null,overlayCSS:{background:"#fff url("+yith_thcncompare.loader+") no-repeat center",backgroundSize:"16px 16px",opacity:.6}}),o.ajax({type:"post",url:yith_thcncompare.ajaxurl.toString().replace("%%endpoint%%",yith_thcncompare.actionremove),data:a,dataType:"html",success:function(e){var a=o(e).filter("#yith-thcncompare");o("#yith-thcncompare").replaceWith(a),o('.compare[data-product_id="'+t.data("product_id")+'"]',window.parent.document).removeClass("added").html(yith_thcncompare.button_text),o(document).trigger("yith_thcncompare_product_removed")}})}),o(".yith-thcncompare-open a, a.yith-thcncompare-open").on("click",function(t){t.preventDefault(),o("body").trigger("yith_thcncompare_open_popup",{response:e("action",yith_thcncompare.actionview)+"&iframe=true"})}),o(".yith-thcncompare-widget").on("click","a.compare",function(e){e.preventDefault(),o("body").trigger("yith_thcncompare_open_popup",{response:o(this).attr("href")})}).on("click","li a.remove, a.clear-all",function(e){e.preventDefault();var t=o(".yith-thcncompare-widget .products-list").data("lang"),a=o(this),r=a.data("product_id"),c={action:yith_thcncompare.actionremove,id:r,context:"frontend",responseType:"product_list",lang:t},n=a.parents(".yith-thcncompare-widget").find("ul.products-list");void 0!==o.fn.block&&n.block({message:null,overlayCSS:{background:"#fff url("+yith_thcncompare.loader+") no-repeat center",backgroundSize:"16px 16px",opacity:.6}}),o.ajax({type:"post",url:yith_thcncompare.ajaxurl.toString().replace("%%endpoint%%",yith_thcncompare.actionremove),data:c,dataType:"html",success:function(e){"all"==r?o(".compare.added").removeClass("added").html(yith_thcncompare.button_text):o('.compare[data-product_id="'+r+'"]').removeClass("added").html(yith_thcncompare.button_text),n.html(e),void 0!==o.fn.block&&n.unblock()}})}),o("body").on("added_to_cart",function(e,t,a,r){o(r).closest("table.compare-list").length&&r.hide()})});