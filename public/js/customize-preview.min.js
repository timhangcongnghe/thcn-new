!function(e){var t,n,i,s,a,o,r,c,u,l=wp.customize,d={};(n=history).replaceState&&(a=function(t){var n,i=document.createElement("a");return i.href=t,n=l.utils.parseQueryString(location.search.substr(1)),(t=l.utils.parseQueryString(i.search.substr(1))).customize_changeset_uuid=n.customize_changeset_uuid,n.customize_autosaved&&(t.customize_autosaved="on"),n.customize_theme&&(t.customize_theme=n.customize_theme),n.customize_messenger_channel&&(t.customize_messenger_channel=n.customize_messenger_channel),i.search=e.param(t),i.href},n.replaceState=(i=n.replaceState,function(e,t,s){return d=e,i.call(n,e,t,"string"==typeof s&&0<s.length?a(s):s)}),n.pushState=(s=n.pushState,function(e,t,i){return d=e,s.call(n,e,t,"string"==typeof i&&0<i.length?a(i):i)}),window.addEventListener("popstate",function(e){d=e.state})),t=function(e,t,n){var i;return function(){var s=arguments;n=n||this,clearTimeout(i),i=setTimeout(function(){i=null,e.apply(n,s)},t)}},l.Preview=l.Messenger.extend({initialize:function(n,i){var s=this,a=document.createElement("a");l.Messenger.prototype.initialize.call(s,n,i),a.href=s.origin(),s.add("scheme",a.protocol.replace(/:$/,"")),s.body=e(document.body),s.window=e(window),l.settings.channel&&(s.body.on("click.preview","a",function(e){s.handleLinkClick(e)}),s.body.on("submit.preview","form",function(e){s.handleFormSubmit(e)}),s.window.on("scroll.preview",t(function(){s.send("scroll",s.window.scrollTop())},200)),s.bind("scroll",function(e){s.window.scrollTop(e)}))},handleLinkClick:function(t){var n=e(t.target).closest("a");if(!_.isUndefined(n.attr("href"))&&"#"!==n.attr("href").substr(0,1)&&/^https?:$/.test(n.prop("protocol"))){if(!l.isLinkPreviewable(n[0]))return wp.a11y.speak(l.settings.l10n.linkUnpreviewable),void t.preventDefault();t.preventDefault(),t.shiftKey||this.send("url",n.prop("href"))}},handleFormSubmit:function(t){var n=document.createElement("a"),i=e(t.target);if(n.href=i.prop("action"),"GET"!==i.prop("method").toUpperCase()||!l.isLinkPreviewable(n))return wp.a11y.speak(l.settings.l10n.formUnpreviewable),void t.preventDefault();t.isDefaultPrevented()||(1<n.search.length&&(n.search+="&"),n.search+=i.serialize(),this.send("url",n.href)),t.preventDefault()}}),l.addLinkPreviewing=function(){var t="a[href], area[href]";e(document.body).find(t).each(function(){l.prepareLinkPreview(this)}),"undefined"!=typeof MutationObserver?(l.mutationObserver=new MutationObserver(function(n){_.each(n,function(n){e(n.target).find(t).each(function(){l.prepareLinkPreview(this)})})}),l.mutationObserver.observe(document.documentElement,{childList:!0,subtree:!0})):e(document.documentElement).on("click focus mouseover",t,function(){l.prepareLinkPreview(this)})},l.isLinkPreviewable=function(e,t){var n,i;t=_.extend({},{allowAdminAjax:!1},t||{});return"javascript:"===e.protocol||("https:"===e.protocol||"http:"===e.protocol)&&(i=e.host.replace(/:(80|443)$/,""),n=document.createElement("a"),!_.isUndefined(_.find(l.settings.url.allowed,function(t){return n.href=t,n.protocol===e.protocol&&n.host.replace(/:(80|443)$/,"")===i&&0===e.pathname.indexOf(n.pathname.replace(/\/$/,""))}))&&!/\/wp-(login|signup)\.php$/.test(e.pathname)&&(/\/wp-admin\/admin-ajax\.php$/.test(e.pathname)?t.allowAdminAjax:!/\/wp-(admin|includes|content)(\/|$)/.test(e.pathname)))},l.prepareLinkPreview=function(t){var n,i=e(t);t.hasAttribute("href")&&(i.closest("#wpadminbar").length||"#"!==i.attr("href").substr(0,1)&&/^https?:$/.test(t.protocol)&&(l.settings.channel&&"https"===l.preview.scheme.get()&&"http:"===t.protocol&&-1!==l.settings.url.allowedHosts.indexOf(t.host)&&(t.protocol="https:"),i.hasClass("wp-playlist-caption")||(l.isLinkPreviewable(t)?(i.removeClass("customize-unpreviewable"),(n=l.utils.parseQueryString(t.search.substring(1))).customize_changeset_uuid=l.settings.changeset.uuid,l.settings.changeset.autosaved&&(n.customize_autosaved="on"),l.settings.theme.active||(n.customize_theme=l.settings.theme.stylesheet),l.settings.channel&&(n.customize_messenger_channel=l.settings.channel),t.search=e.param(n)):l.settings.channel&&i.addClass("customize-unpreviewable"))))},l.addRequestPreviewing=function(){e.ajaxPrefilter(function(t,n,i){var s,a,o={},r=document.createElement("a");r.href=t.url,l.isLinkPreviewable(r,{allowAdminAjax:!0})&&(s=l.utils.parseQueryString(r.search.substring(1)),l.each(function(e){e._dirty&&(o[e.id]=e.get())}),_.isEmpty(o)||("POST"!==(a=t.type.toUpperCase())&&(i.setRequestHeader("X-HTTP-Method-Override",a),s._method=a,t.type="POST"),t.data?t.data+="&":t.data="",t.data+=e.param({customized:JSON.stringify(o)})),s.customize_changeset_uuid=l.settings.changeset.uuid,l.settings.changeset.autosaved&&(s.customize_autosaved="on"),l.settings.theme.active||(s.customize_theme=l.settings.theme.stylesheet),s.customize_preview_nonce=l.settings.nonce.preview,r.search=e.param(s),t.url=r.href)})},l.addFormPreviewing=function(){e(document.body).find("form").each(function(){l.prepareFormPreview(this)}),"undefined"!=typeof MutationObserver&&(l.mutationObserver=new MutationObserver(function(t){_.each(t,function(t){e(t.target).find("form").each(function(){l.prepareFormPreview(this)})})}),l.mutationObserver.observe(document.documentElement,{childList:!0,subtree:!0}))},l.prepareFormPreview=function(t){var n,i={};t.action||(t.action=location.href),(n=document.createElement("a")).href=t.action,l.settings.channel&&"https"===l.preview.scheme.get()&&"http:"===n.protocol&&-1!==l.settings.url.allowedHosts.indexOf(n.host)&&(n.protocol="https:",t.action=n.href),"GET"===t.method.toUpperCase()&&l.isLinkPreviewable(n)?(e(t).removeClass("customize-unpreviewable"),i.customize_changeset_uuid=l.settings.changeset.uuid,l.settings.changeset.autosaved&&(i.customize_autosaved="on"),l.settings.theme.active||(i.customize_theme=l.settings.theme.stylesheet),l.settings.channel&&(i.customize_messenger_channel=l.settings.channel),_.each(i,function(n,i){var s=e(t).find('input[name="'+i+'"]');s.length?s.val(n):e(t).prepend(e("<input>",{type:"hidden",name:i,value:n}))}),l.settings.channel&&(t.target="_self")):l.settings.channel&&e(t).addClass("customize-unpreviewable")},l.keepAliveCurrentUrl=(o=location.pathname,r=location.search.substr(1),c=null,u=["customize_theme","customize_changeset_uuid","customize_messenger_channel","customize_autosaved"],function(){var t,n;r!==location.search.substr(1)||o!==location.pathname?(t=document.createElement("a"),null===c&&(t.search=r,c=l.utils.parseQueryString(r),_.each(u,function(e){delete c[e]})),t.href=location.href,n=l.utils.parseQueryString(t.search.substr(1)),_.each(u,function(e){delete n[e]}),o===location.pathname&&_.isEqual(c,n)?l.preview.send("keep-alive"):(t.search=e.param(n),t.hash="",l.settings.url.self=t.href,l.preview.send("ready",{currentUrl:l.settings.url.self,activePanels:l.settings.activePanels,activeSections:l.settings.activeSections,activeControls:l.settings.activeControls,settingValidities:l.settings.settingValidities})),c=n,r=location.search.substr(1),o=location.pathname):l.preview.send("keep-alive")}),l.settingPreviewHandlers={custom_logo:function(t){e("body").toggleClass("wp-custom-logo",!!t)},custom_css:function(t){e("#wp-custom-css").text(t)},background:function(){var t="",n={};_.each(["color","image","preset","position_x","position_y","size","repeat","attachment"],function(e){n[e]=l("background_"+e)}),e(document.body).toggleClass("custom-background",!(!n.color()&&!n.image())),n.color()&&(t+="background-color: "+n.color()+";"),n.image()&&(t+='background-image: url("'+n.image()+'");',t+="background-size: "+n.size()+";",t+="background-position: "+n.position_x()+" "+n.position_y()+";",t+="background-repeat: "+n.repeat()+";",t+="background-attachment: "+n.attachment()+";"),e("#custom-background-css").text("body.custom-background { "+t+" }")}},e(function(){var t,n,i;l.settings=window._wpCustomizeSettings,l.settings&&(l.preview=new l.Preview({url:window.location.href,channel:l.settings.channel}),l.addLinkPreviewing(),l.addRequestPreviewing(),l.addFormPreviewing(),n=function(e,t,n){var i=l(e);i?i.set(t):(n=n||!1,i=l.create(e,t,{id:e}),n&&(i._dirty=!0))},l.preview.bind("settings",function(t){e.each(t,n)}),l.preview.trigger("settings",l.settings.values),e.each(l.settings._dirty,function(e,t){(t=l(t))&&(t._dirty=!0)}),l.preview.bind("setting",function(e){n.apply(null,e.concat(!0))}),l.preview.bind("sync",function(t){t.settings&&t["settings-modified-while-loading"]&&_.each(_.keys(t.settings),function(e){l.has(e)&&!t["settings-modified-while-loading"][e]&&delete t.settings[e]}),e.each(t,function(e,t){l.preview.trigger(e,t)}),l.preview.send("synced")}),l.preview.bind("active",function(){l.preview.send("nonce",l.settings.nonce),l.preview.send("documentTitle",document.title),l.preview.send("scroll",e(window).scrollTop())}),i=function(t){l.settings.changeset.uuid=t,e(document.body).find("a[href], area[href]").each(function(){l.prepareLinkPreview(this)}),e(document.body).find("form").each(function(){l.prepareFormPreview(this)}),history.replaceState&&history.replaceState(d,"",location.href)},l.preview.bind("changeset-uuid",i),l.preview.bind("saved",function(e){e.next_changeset_uuid&&i(e.next_changeset_uuid),l.trigger("saved",e)}),l.preview.bind("autosaving",function(){l.settings.changeset.autosaved||(l.settings.changeset.autosaved=!0,e(document.body).find("a[href], area[href]").each(function(){l.prepareLinkPreview(this)}),e(document.body).find("form").each(function(){l.prepareFormPreview(this)}),history.replaceState&&history.replaceState(d,"",location.href))}),l.preview.bind("changeset-saved",function(e){_.each(e.saved_changeset_values,function(e,t){(t=l(t))&&_.isEqual(t.get(),e)&&(t._dirty=!1)})}),l.preview.bind("nonce-refresh",function(t){e.extend(l.settings.nonce,t)}),l.preview.send("ready",{currentUrl:l.settings.url.self,activePanels:l.settings.activePanels,activeSections:l.settings.activeSections,activeControls:l.settings.activeControls,settingValidities:l.settings.settingValidities}),setInterval(l.keepAliveCurrentUrl,l.settings.timeouts.keepAliveSend),l.preview.bind("loading-initiated",function(){e("body").addClass("wp-customizer-unloading")}),l.preview.bind("loading-failed",function(){e("body").removeClass("wp-customizer-unloading")}),t=e.map(["color","image","preset","position_x","position_y","size","repeat","attachment"],function(e){return"background_"+e}),l.when.apply(l,t).done(function(){e.each(arguments,function(){this.bind(l.settingPreviewHandlers.background)})}),l("custom_logo",function(e){l.settingPreviewHandlers.custom_logo.call(e,e.get()),e.bind(l.settingPreviewHandlers.custom_logo)}),l("custom_css["+l.settings.theme.stylesheet+"]",function(e){e.bind(l.settingPreviewHandlers.custom_css)}),l.trigger("preview-ready"))})}((wp,jQuery));